<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cafe Service</title>
    <!-- 여기에 필요한 CSS 파일 및 스타일 시트 링크를 추가하세요 -->
    <link href="css/popup.css" rel="stylesheet" />

</head>
<body>
<style>
    .nav {
    }

    .navBar {
        display: flex;
        flex-direction: row;
        margin-left: 15vmax;
        padding: 5px 5px 5px 5px;
        align-items: center;
    }

    .a {
        text-decoration: none;
        color: black;
    }

    .e1 {
        font-size: 25px;
        display: flex;
        margin-right: 17vmax;
    }

    .e2 {
        font-size: 15px;
        display: flex;
        margin-right: 7vmax;
    }

    h1 {
        text-align: center;
        font-family: "Seymour One", sans-serif;
        color: black;
        margin-bottom: 6.67vmax;
        font-size: 4vmax;
        margin-top: 2.67vmax;
        margin-bottom: 2.67vmax;
    }

    .fullBox1 {
        padding-left: 15vmax;
        padding-right: 15vmax;
        text-align: center;
        border: 1px solid rgb(240, 240, 240);
        background-color: white;
        padding-bottom: 2vmax;
    }

    .fullBox2 {
        padding-left: 15vmax;
        padding-right: 15vmax;
        text-align: center;
        border: 1px solid rgb(245, 245, 245);
        background-color: rgb(245, 245, 245);
        padding-bottom: 2vmax;
    }

    a {
        color: black;
    }

    .button {
        background-color: rgb(240, 230, 230);
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
    }

    .button2 {
        background-color: rgb(230, 230, 240);
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
    }

    .button:hover {
        transform: scale(1.1);
    }

    .button2:hover {
        transform: scale(1.1);
    }

</style>
<div class="navBar">
    <div class="e1">
        <a class="a"  href="http://localhost:8080"><strong>Cafe Service</strong></a>
    </div>

    <div class="e2">
        <a class="a" target="_blank" href="https://codepen.io/quang_ngo/full/rNaYXOb"
           th:href="@{https://codepen.io/quang_ngo/full/rNaYXOb}">About Me</a>
    </div>

    <div class="e2">
        <a class="a" target="_blank" href="https://codepen.io/quang_ngo/full/yLyzpvL"
           th:href="@{https://codepen.io/quang_ngo/full/yLyzpvL}">My Motto</a>
    </div>

    <div class="e2">
        <a class="a" target="_blank" href="https://codepen.io/quang_ngo/full/jOEepPG"
           th:href="@{https://codepen.io/quang_ngo/full/jOEepPG}">storeName</a>
    </div>

    <div class="e2">
        <a class="a" target="_blank" href="https://codepen.io/quang_ngo/full/dyPJpOM"
           th:href="@{https://codepen.io/quang_ngo/full/dyPJpOM}">Contact</a>
    </div>
</div>
<hr>


<div class="fullBox1">
    <h1 id="storeName" th:text="${store.storeName}">Loading...</h1>
    <h3 id="storeAddress" th:text="${store.storeAddress}">Loading...</h3>
    <p id="information" th:text="${store.information}">Loading...</p>

<!--        <p><a button type="button" class="button2" href="#popup1">UPDATE CAFE</a></p>-->
<!--        <p><a button type="button" class="button2" href="#popup2">DELETE CAFE</a></p>-->
        <div class="button2">
            <p><a href="#popup1">UPDATE CAFE</a></p>
        </div>
        <div class="button2">
            <p><a href="#popup2">DELETE CAFE</a></p>
        </div>

</div>


    <div id="popup1" class="overlay">
        <div class="popup">
            <h2>UPDATE</h2>
            <a class="close" href="#">&times;</a>
            <div class="content">
                <form id="updateStoreForm">
                    <label for="storeName">Store Name:</label>
                    <input type="text" id="updateStoreName" name="storeName" required /><br />

                    <label for="storeAddress">Store Address:</label>
                    <input type="text" id="updateStoreAddress" name="storeAddress" required /><br />

                    <label for="information">Information:</label>
                    <input type="text" id="updateInformation" name="information" required /><br />

                    <label for="information">Password:</label>
                    <input type="text" id="updatePassword" name="password" required /><br />

                    <input type="submit" value="Update" onclick="updateStore()">
                </form>
            </div>
        </div>
    </div>

    <div id="popup2" class="overlay">
        <div class="popup">
            <h2>DELETE</h2>
            <a class="close" href="#">&times;</a>
            <div class="content">
                <form id="createStoreForm">
                    <label for="storeName">Password:</label>
                    <input type="text" id="deletePassword" name="password" required /><br />
                    <input type="submit" value="Delete" onclick="deleteStore()">
                </form>
            </div>
        </div>
    </div>


<div class="fullBox2">
    <h3>Menu</h3>
    <!--카드 컨테이너-->
    <div class="card">
        <p th:text="${menuName}">menuName</p>
        <p th:text="${price}">price</p>
    </div>
        <!-- 다른 카드들도 동일한 방식으로 추가 -->
    </div>
</div>

<div class="button2">
    <a target="_blank" href="https://codepen.io/quang_ngo/full/wvBOmqw"
       th:href="@{https://codepen.io/quang_ngo/full/wvBOmqw}">주문하기</a>
</div>
<div class="button2">
    <a target="_blank" href="https://codepen.io/quang_ngo/full/povYLrb"
       th:href="@{https://codepen.io/quang_ngo/full/povYLrb}">리뷰달기</a>
</div>

<div class="fullBox1">
    <h3>Review</h3>
    <!--리뷰 컨테이너-->
    <div class="card">
        <p th:text="${review}">review</p>
        <p th:text="${star}">star</p>
    </div>
    <!--여기까지-->
</div>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>

<script>
    $(document).ready(function () {
        getStore();
    })

    function getStore() {
        const currentUrl = window.location.href;

        // URL에서 storeId 값을 추출합니다.
        const urlParams = new URLSearchParams(currentUrl);
        const storeId = urlParams.get("id"); // URL에서 "id" 파라미터를 가져옵니다.

        // 추출한 storeId 값을 사용하여 RESTful URL을 생성합니다.
        const restfulUrl = `/api/stores/${storeId}`;
        $.ajax({
            type: "GET",
            url: restfulUrl,
            data: {},
            success: function (response) {
                const storeName = response.storeName;
                const storeAddress = response.storeAddress;
                const information = response.information;

                // 값을 가져왔는지 로그로 확인
                console.log("storeName:", storeName);
                console.log("storeAddress:", storeAddress);
                console.log("information:", information);

                // 값을 가져온 후 Thymeleaf로 동적으로 설정
                $('#storeName').text(storeName);
                $('#storeAddress').text(storeAddress);
                $('#information').text(information);

            },
            error: function (error) {
                // AJAX 요청이 실패한 경우에 대한 처리
            }
        });
    }



    /**/
    function updateStore() {
        const id = document.location.href.split("=")[1];
        const token = Cookies.get('Authorization');

        $.ajax({
            url: "/api/stores/"+id,
            method: "PUT",
            timeout: 0,
            headers: {
                "Content-Type": "application/json",
                "Authorization": token // 토큰을 헤더에 추가
            },
            data: JSON.stringify({
                password: $("#updatePassword").val(),
                storeName: $("#updateStoreName").val(),
                storeAddress: $("#updateStoreAddress").val(),
                information: $("#updateInformation").val()
            }),
            success: function (response) {
                alert("수정되었습니다.")
                window.location.href = "/index.html";
            },
            error: function (error) {
                alert("수정 실패! 다시 확인해주세요.")

            }
        })

    }

    /**/
    function deleteStore() {
        const id = document.location.href.split("=")[1];
        const token = Cookies.get('Authorization');

        $.ajax({
            type: "DELETE",
            url: "/api/stores/" + id,
            data: {},
            headers: {
                "Content-Type": "application/json",
                "Authorization": token // 토큰을 헤더에 추가
            },
            success: function (response) {
                alert("삭제되었습니다.")
                window.location.href = "/index.html"
            },
            error: function (errorMessage) {
                alert(errorMessage["responseJSON"]["message"])
            }
        })

    }
</script>

</body>
</html>
